# 使用示例教程

本文档提供详细的使用示例，帮助您快速上手火山引擎APM数据导出工具。

## 📚 目录

1. [快速开始](#快速开始)
2. [基础示例](#基础示例)
3. [高级示例](#高级示例)
4. [常见场景](#常见场景)
5. [最佳实践](#最佳实践)

## 🚀 快速开始

### 第一次使用

1. **安装脚本后访问控制台**
   ```
   https://console.volcengine.com/
   ```

2. **查看触发按钮**
   - 登录成功后，页面右上方会出现紫色渐变按钮
   - 按钮文字：📊 APM数据导出

3. **点击按钮打开面板**
   - 面板会显示在屏幕中央
   - 自动检测认证状态
   - 显示绿色提示表示认证成功

## 📋 基础示例

### 示例1：导出单个应用的7天数据

**场景**：快速导出一个应用最近7天的性能数据

**操作步骤**：

1. 点击"📊 APM数据导出"按钮

2. 在"应用ID列表"中输入：
   ```
   appid_12345
   ```

3. 在"应用名称映射"中输入：
   ```json
   {
     "appid_12345": "主站Web应用"
   }
   ```

4. 时间范围选择：**最近7天**

5. 请求间隔：保持默认 **1000毫秒**

6. 点击"开始批量导出"

**预期结果**：
- 自动下载文件：`主站Web应用_性能数据_最近7天_2024-01-20_2024-01-27.csv`
- 日志显示：✓ 主站Web应用 导出成功

### 示例2：批量导出3个应用的30天数据

**场景**：同时导出多个应用的月度性能报告

**操作步骤**：

1. 应用ID列表：
   ```
   appid_web_main
   appid_mobile_h5
   appid_admin
   ```

2. 应用名称映射：
   ```json
   {
     "appid_web_main": "主站Web应用",
     "appid_mobile_h5": "移动端H5应用",
     "appid_admin": "管理后台系统"
   }
   ```

3. 时间范围：**最近30天**

4. 请求间隔：**1500毫秒**（批量导出建议增加间隔）

5. 点击"开始批量导出"

**预期结果**：
- 依次下载3个CSV文件
- 进度条显示：33% → 67% → 100%
- 日志显示3条成功记录
- 最终提示：批量导出完成！成功: 3, 失败: 0

## 🎓 高级示例

### 示例3：自定义时间范围导出

**场景**：导出特定促销活动期间的数据（如双十一）

**操作步骤**：

1. 应用ID列表：
   ```
   appid_ecommerce
   ```

2. 应用名称映射：
   ```json
   {
     "appid_ecommerce": "电商平台"
   }
   ```

3. 时间范围：选择 **自定义时间**

4. 开始日期：**2024-11-10**

5. 结束日期：**2024-11-12**

6. 点击"开始批量导出"

**预期结果**：
- 文件名：`电商平台_性能数据_自定义时间_2024-11-10_2024-11-12.csv`
- 包含指定日期范围的数据

### 示例4：大批量应用导出（10+应用）

**场景**：导出所有业务线的季度性能报告

**操作步骤**：

1. 应用ID列表（10个应用）：
   ```
   app_business_01
   app_business_02
   app_business_03
   app_business_04
   app_business_05
   app_business_06
   app_business_07
   app_business_08
   app_business_09
   app_business_10
   ```

2. 应用名称映射：
   ```json
   {
     "app_business_01": "业务线1-主站",
     "app_business_02": "业务线2-社区",
     "app_business_03": "业务线3-电商",
     "app_business_04": "业务线4-内容",
     "app_business_05": "业务线5-工具",
     "app_business_06": "业务线6-服务",
     "app_business_07": "业务线7-数据",
     "app_business_08": "业务线8-运营",
     "app_business_09": "业务线9-客服",
     "app_business_10": "业务线10-分析"
   }
   ```

3. 时间范围：**最近90天**

4. 请求间隔：**2000毫秒**（大批量建议2秒间隔）

5. 点击"开始批量导出"

**注意事项**：
- 总耗时约：10个应用 × 2秒 = 20秒
- 浏览器可能提示"允许多个文件下载"，请点击允许
- 可以在进度条下方实时查看导出日志

**预期结果**：
- 下载10个CSV文件
- 每个文件约几十KB到几MB不等
- 日志详细记录每个应用的导出状态

## 🎯 常见场景

### 场景A：周报数据准备

**需求**：每周一导出上周的性能数据用于周报

**配置建议**：
```
应用ID：你的核心应用ID
时间范围：最近7天
请求间隔：1000毫秒
```

**操作提示**：
- 可以保存常用应用ID配置（脚本会自动保存）
- 下次打开面板时会自动加载上次的配置

### 场景B：月度性能报告

**需求**：每月初导出上个月的完整数据

**配置建议**：
```
应用ID：所有业务应用ID
时间范围：自定义时间
开始日期：上月1号
结束日期：上月最后一天
请求间隔：1500毫秒
```

### 场景C：问题排查

**需求**：某个页面性能突然下降，需要导出近期数据分析

**配置建议**：
```
应用ID：问题应用ID
时间范围：最近30天
请求间隔：1000毫秒
```

**分析方法**：
1. 导出CSV后用Excel打开
2. 找到问题页面（通过pid列）
3. 观察FCP、LCP等指标的变化趋势
4. 对比PV是否有异常波动

### 场景D：性能对比分析

**需求**：对比多个应用的性能表现

**配置建议**：
```
应用ID：需要对比的所有应用ID
时间范围：最近30天
请求间隔：1000毫秒
```

**分析方法**：
1. 批量导出所有应用数据
2. 使用Excel或数据分析工具合并数据
3. 通过"应用名称"列进行分组对比
4. 生成性能对比图表

## 💡 最佳实践

### 1. 应用ID管理

**推荐做法**：
- 在配置面板中维护完整的应用ID和名称映射
- 使用有意义的应用名称，便于后续数据分析
- 定期更新映射配置，确保与实际应用保持一致

**示例映射结构**：
```json
{
  "appid_prod_web": "生产环境-Web主站",
  "appid_prod_mobile": "生产环境-移动H5",
  "appid_test_web": "测试环境-Web主站",
  "appid_pre_web": "预发布环境-Web主站"
}
```

### 2. 时间范围选择

| 用途 | 推荐时间范围 | 说明 |
|------|-------------|------|
| 日常监控 | 最近7天 | 快速查看近期趋势 |
| 周报 | 最近7天 | 一周数据汇总 |
| 月报 | 最近30天 | 月度数据分析 |
| 季报 | 最近90天 | 季度性能评估 |
| 活动复盘 | 自定义时间 | 精确到活动时间段 |

### 3. 请求间隔设置

| 应用数量 | 推荐间隔 | 总耗时估算 |
|---------|---------|-----------|
| 1-3个 | 1000ms | 3-9秒 |
| 4-10个 | 1500ms | 6-15秒 |
| 10+个 | 2000ms | 20秒以上 |

**原则**：
- 少量应用：1秒间隔即可
- 中量应用：1.5秒间隔更稳定
- 大量应用：2秒间隔避免限流

### 4. 数据导出后处理

**Excel处理步骤**：

1. **打开CSV文件**
   - Excel → 文件 → 打开
   - 选择UTF-8编码

2. **数据清洗**
   - 删除无效行（如PV=0的页面）
   - 过滤异常数据

3. **数据分析**
   - 按页面排序（pid列）
   - 计算平均值、中位数
   - 生成图表

4. **报告生成**
   - 创建数据透视表
   - 添加趋势图
   - 标注关键指标

### 5. 错误处理

**遇到导出失败时**：

1. **查看错误日志**
   - 面板底部日志区域会显示详细错误信息

2. **常见错误及解决**：
   - "认证信息获取失败" → 刷新页面重新登录
   - "API错误" → 检查应用ID是否正确
   - "网络请求失败" → 检查网络连接
   - "请求超时" → 增加请求间隔

3. **重试策略**：
   - 脚本会自动重试失败的请求（最多3次）
   - 如仍然失败，可手动减少批量数量

## 🔍 调试技巧

### 查看详细请求信息

1. 按 `F12` 打开浏览器开发者工具
2. 切换到 "Network" 标签
3. 筛选 "Fetch/XHR"
4. 找到 "DashboardCustomGraphDraw" 请求
5. 查看请求头、请求体和响应数据

### 修改默认配置

如需修改默认值，在脚本中找到对应部分：

```javascript
// 修改默认应用映射
const DEFAULT_APP_MAPPING = {
    "your_appid": "你的应用名称"
};

// 修改默认请求间隔
document.getElementById('apm-request-interval').value = '2000';
```

## 📊 数据分析示例

### CSV数据结构示例

```csv
应用ID,应用名称,pid,FCP(ms),LCP(ms),FID(ms),CLS,TTFB(ms),PV
appid_001,主站Web应用,/home,800,1200,50,0.05,200,15000
appid_001,主站Web应用,/product,900,1500,60,0.08,250,8000
appid_001,主站Web应用,/cart,850,1300,55,0.06,220,5000
```

### Excel数据透视表

**行标签**：pid（页面）
**值**：
- 平均 FCP
- 平均 LCP
- 总 PV

**筛选器**：
- 应用名称
- 日期范围

## 🎬 完整操作视频流程（文字版）

1. **[0:00]** 打开火山引擎控制台并登录
2. **[0:05]** 点击右上角"📊 APM数据导出"按钮
3. **[0:08]** 配置面板弹出，显示认证成功
4. **[0:10]** 在应用ID列表中输入应用ID
5. **[0:15]** 配置应用名称映射（JSON格式）
6. **[0:20]** 选择时间范围"最近30天"
7. **[0:22]** 设置请求间隔"1000毫秒"
8. **[0:25]** 点击"开始批量导出"按钮
9. **[0:26]** 进度条开始滚动，日志实时更新
10. **[0:30]** 第一个CSV文件自动下载
11. **[0:32]** 所有应用导出完成
12. **[0:35]** 查看下载文件夹，打开CSV文件
13. **[0:40]** 在Excel中查看数据

## 📝 配置模板

### 小型团队配置

```json
{
  "appid_web": "公司官网",
  "appid_app": "移动应用",
  "appid_admin": "管理后台"
}
```

### 中型团队配置

```json
{
  "appid_web_prod": "生产-Web主站",
  "appid_web_test": "测试-Web主站",
  "appid_mobile_prod": "生产-移动端",
  "appid_mobile_test": "测试-移动端",
  "appid_admin_prod": "生产-管理后台",
  "appid_admin_test": "测试-管理后台"
}
```

### 大型团队配置

```json
{
  "appid_business_a_web": "业务线A-Web",
  "appid_business_a_h5": "业务线A-H5",
  "appid_business_b_web": "业务线B-Web",
  "appid_business_b_h5": "业务线B-H5",
  "appid_business_c_web": "业务线C-Web",
  "appid_business_c_h5": "业务线C-H5",
  "appid_platform_main": "平台-主站",
  "appid_platform_api": "平台-API",
  "appid_admin_system": "管理系统",
  "appid_data_analysis": "数据分析"
}
```

## ❓ 常见问题

### Q1: 可以同时导出多少个应用？
A: 理论上没有限制，但建议单次不超过50个，避免浏览器卡顿。

### Q2: 导出的数据是实时的吗？
A: 数据来自火山引擎APM系统，通常有几分钟的延迟。

### Q3: CSV文件可以重复导出吗？
A: 可以，每次导出都会生成新文件，不会覆盖之前的文件。

### Q4: 支持导出其他格式吗？
A: 当前仅支持CSV格式，CSV可以在Excel、Google Sheets等工具中打开。

### Q5: 配置会保存吗？
A: 会的，应用ID和映射配置会自动保存在浏览器本地，下次打开自动加载。

---

希望这些示例能帮助您快速掌握工具的使用！如有其他问题，欢迎反馈。🎉

